---
import DashboardLayout from "../../../../layouts/dashboard/DashboardLayout.astro";
import DrawParticipantsView from "../../../../components/DrawParticipants/DrawParticipantsView";
import { DrawService } from "../../../../lib/services/draw.service";

const { drawId } = Astro.params;

// Validate drawId is present
if (!drawId) {
  return Astro.redirect("/dashboard");
}

// TODO: Replace with actual authenticated user ID once auth is implemented
const mockUserId = "00000000-0000-0000-0000-000000000000";

// Fetch draw details to get the name
const drawService = new DrawService(Astro.locals.supabase);
const draw = await drawService.getDrawByIdForAuthor(drawId, mockUserId);

// If draw not found or user is not author, redirect to dashboard
if (!draw) {
  return Astro.redirect("/dashboard");
}
---

<DashboardLayout title={`${draw.name} - Participants`}>
  <DrawParticipantsView client:load drawId={drawId} drawName={draw.name} />
</DashboardLayout>
