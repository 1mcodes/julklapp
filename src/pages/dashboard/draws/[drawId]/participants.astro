---
import DashboardLayout from "../../../../layouts/dashboard/DashboardLayout.astro";
import DrawParticipantsView from "../../../../components/DrawParticipants/DrawParticipantsView";
import { DrawService } from "../../../../lib/services/draw.service";
import { requireAuth } from "../../../../lib/utils/auth.utils";

export const prerender = false;

// Require authentication
const user = await requireAuth(Astro);

const { drawId } = Astro.params;

// Validate drawId is present
if (!drawId) {
  return Astro.redirect("/dashboard");
}

// Fetch draw details to get the name
const drawService = new DrawService(Astro.locals.supabase);
const draw = await drawService.getDrawByIdForAuthor(drawId, user.id);

// If draw not found or user is not author, redirect to dashboard
if (!draw) {
  return Astro.redirect("/dashboard");
}
---

<DashboardLayout title={`${draw.name} - Participants`} activeTab="created" user={user}>
  <DrawParticipantsView client:load drawId={drawId} drawName={draw.name} />
</DashboardLayout>
